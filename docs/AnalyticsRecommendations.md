# Analytics Page — Функции для реализации

## Структура данных

| Таблица | Ключевые поля |
|---------|---------------|
| **Projects** | Id, Title, Description, CreatedAt, IsArchived |
| **Users** | Id, Username, FullName, JobTitle, Role, IsActive |
| **Tasks** | Id, Title, Status, Priority, CreatedAt, Deadline, EstimatedHours, ProjectId, AssigneeId |
| **TimeLogs** | Id, StartTime, EndTime, Comment, IsManual, TaskId, UserId |

---

## Функции для реализации (6 пунктов)

### 1. Загальна кількість відпрацьованих годин
**Группировка:**
- По сотруднику (`UserId`)
- По проекту (`ProjectId` через `Tasks`)
- По задаче (`TaskId`)

**Визуализация:** KPI карточки + Bar Charts

**SQL-логика:**
```sql
SELECT SUM(EndTime - StartTime) as TotalHours
FROM TimeLogs
WHERE UserId = @UserId
GROUP BY DATE(StartTime)
```

---

### 2. Продуктивність співробітника
**Показатели:**
- Количество завершённых задач (`Status = Done`)
- Залогированные часы (`SUM(TimeLogs)`)
- Средняя длительность выполнения задачи

**Визуализация:** 
- Число завершённых задач (большая цифра)
- Залогированные часы (число + тренд)
- Средняя длительность (сравнение с командой)

---

### 3. Розподіл робочого часу
**Показатели:**
- % времени по задачам
- % времени по проектам

**Визуализация:** Pie Chart / Donut Chart

**SQL-логика:**
```sql
SELECT p.Title, SUM(tl.EndTime - tl.StartTime) as Hours
FROM TimeLogs tl
JOIN Tasks t ON tl.TaskId = t.Id
JOIN Projects p ON t.ProjectId = p.Id
WHERE tl.UserId = @UserId
GROUP BY p.Id
```

---

### 4. Динаміка роботи (графіки)
**Периоды:**
- По дням (последние 7-14 дней)
- По неделям (последние 4-8 недель)
- По месяцам (последние 6-12 месяцев)

**Визуализация:** Line Chart / Area Chart

**Что показывает:**
- Падение/рост продуктивности
- Пиковые периоды загрузки
- Стабильность работы

---

### 5. Аналіз затрат на задачі
**Для каждой задачи:**
- Фактическое время (`SUM(TimeLogs)`)
- Оценочное время (`EstimatedHours`)
- Точность оценки (`EstimatedHours / ActualHours * 100%`)
- Сравнение с дедлайном (`Deadline`)

**Визуализация:** 
- Estimated vs Actual Bar Chart
- Точность оценки Gauge (%)
- Список просроченных задач

---

### 6. Аналіз проектів
**Для каждого проекта:**
- Суммарные часы
- Топ-3 самых трудоёмких задач
- Сотрудники с наибольшим участием

**Визуализация:**
- Horizontal Bar Chart (часы по проектам)
- Progress Bar (% завершённых задач)
- Таблица с участниками

---

## Приоритет реализации

```
Phase 1 (MVP):
├── 1. Часы по сотруднику/проекту/задаче
├── 2. Продуктивность (завершённые задачи, часы)
└── 5. Estimated vs Actual на задачу

Phase 2 (Enhanced):
├── 4. Графики динамики (дни/недели/месяцы)
├── 3. Распределение времени (% по проектам)
└── 6. Аналитика проектов
```

---

## UI Layout (предложение)

```
┌──────────────────────────────────────────────────────────────┐
│  📅 Period: [Today] [Week] [Month] [Custom]    👤 User: [All]│
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────────┐         │
│  │ 32.5h  │  │ 8      │  │ 4      │  │ 92%        │         │
│  │ Hours  │  │ Done   │  │ Active │  │ Accuracy   │         │
│  └────────┘  └────────┘  └────────┘  └────────────┘         │
│                                                              │
│  ┌─────────────────────────┐ ┌─────────────────────────────┐│
│  │  Weekly Activity        │ │  Time by Project            ││
│  │  [Line/Bar Chart]       │ │  [Pie/Donut Chart]          ││
│  └─────────────────────────┘ └─────────────────────────────┘│
│                                                              │
│  ┌──────────────────────────────────────────────────────────┐│
│  │  Estimated vs Actual Hours                               ││
│  │  [Horizontal Bar Chart comparing tasks]                  ││
│  └──────────────────────────────────────────────────────────┘│
└──────────────────────────────────────────────────────────────┘
```

---

## Примечания

- **Роли:** Обычный пользователь видит только свои данные, Admin/Manager — все
- **Период по умолчанию:** Текущая неделя
- **Библиотеки для графиков:** LiveCharts2, OxyPlot, или ScottPlot для WPF
